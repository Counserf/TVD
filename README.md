# TVD - Tactical Victory Determination

TVD (Tactical Victory Determination) — это скриптовый мод для Arma 3, разработанный для SolidGames, добавляющий механику подсчёта очков, управления задачами, отступления и завершения миссии на основе действий игроков и заданных условий. Подходит для PvP и кооперативных сценариев с двумя сторонами, определяемыми через `mission_parameters.hpp` (`blueforSide` и `opforSide`).

## Основные возможности
- **Динамическое завершение миссии**:
  - ```Истечение времени (код 1) с плавным дебрифингом через `TVD_smoothEnd````
  - ```Тяжёлые потери (код 2) с возможностью продления командиром```
  - ```Отступление стороны (код 3) с передачей техники врагу```
  - ```Выполнение ключевой задачи (код 4) с немедленным завершением```

- **Интерфейс администратора**:
  - ```Вызывается через `Ctrl + ]` для администраторов (`serverCommandAvailable "#kick"`)```
  - ```"Техническое завершение" — плавное завершение с уведомлением, затемнением и дебрифингом```
  - ```"Завершение без реплея" — быстрое завершение с уведомлением```
  - ```"Убить всех ботов" — уничтожение всех AI-юнитов без уведомления игроков```

- **Логирование и дебрифинг**:
  - ```Все события (убийства, задачи, отступления) записываются в лог миссии```
  - ```Дебрифинг отображается при завершении с реплеем```
  - ```Логирование админских действий в серверный лог```

- **Уведомления игроков**:
  - ```Отправка сообщений всем или выбранным сторонам (заголовки, динамический текст, уведомления о задачах)```

- **Расширения**:
  - ```Обыск юнитов с интеграцией ACE3 для плена и бессознательного состояния```
  - ```Маркировка ящиков с временными маркерами на карте```

## Scoring System
- **Юниты**: 
  - Обычные солдаты: 10 очков.
  - Командир стороны (КС): 50 очков.
  - Командиры отделений (КО): 25 очков.
- **Техника**: 
  - Самолёты: 150 (вооружённые) / 75 (невооружённые).
  - Танки и вертолёты: 100/40 (гусеничные) или 100/50 (воздушные).
  - Машины: 60/30.
  - Лодки: 50/20.
  - Статичное оружие: 30.
  - Прочее: 25.
- **Зоны**: 50 очков за каждую.
- **Захват техники**: 50% от ценности.
- **Захват и отправка в резерв**: 100% (50% при захвате + 50% при отправке).
- **Резерв**: 100% (свои юниты/техника), 50% (захваченное).

## Требования
- **Arma 3** (версия 2.0+ рекомендуется).
- **Сборка SolidGames**
  - **CBA** (Community Base Addons) — для асинхронных функций и обработчиков событий.
  - **ACE3** (опционально) — для механик плена и обыска.
  - **Atrium** - для механики завершения миссии

## Установка

### Подготовка структуры миссии
1. Создайте папку миссии в `Documents\Arma 3\missions`, например, `TVD_Mission.Stratis`.
2. Скопируйте папку `TVD` из репозитория в корень миссии. Итоговая структура:
   ```text
   TVD_Mission.Stratis/
   ├── description.ext
   ├── init.sqf
   ├── mission_parameters.hpp
   ├── stringtable.xml
   └── TVD/
       ├── config.sqf
       ├── core/
       │   ├── init.sqf
       │   ├── main.sqf
       │   ├── score.sqf
       │   ├── tasks.sqf
       │   └── end.sqf
       ├── client/
       │   ├── actions.sqf
       │   ├── admin_menu.sqf
       │   └── ui.sqf
       ├── utils/
       │   ├── helpers.sqf
       │   └── logging.sqf
       ├── ext/
       │   ├── init.sqf
       │   ├── frisk.sqf
       │   └── mark_box.sqf
       └── actions/
           ├── retreat.sqf
           ├── reserve.sqf
           ├── capture.sqf
           ├── hq_transfer.sqf
           └── heavy_losses.sqf
   ```

### Настройка `description.ext`
Убедитесь, что в `description.ext` подключены параметры миссии:
```cpp
class A3A_MissionParams {
    #include "mission_parameters.hpp"
};
```

### Настройка `mission_parameters.hpp`
Укажите стороны конфликта:
```cpp
// Противоборствующие стороны ("WEST", "EAST", "INDEPENDENT")
blueforSide = "WEST";
opforSide = "EAST";
```
- Допустимые значения: `"WEST"`, `"EAST"`, `"INDEPENDENT"`.
- Союзники `INDEPENDENT` определяются в редакторе через настройки фракций.

### Настройка `init.sqf`
Добавьте в `init.sqf` в корне миссии следующий код для запуска TVD:
```sqf
if (isServer) then {  
    waitUntil {sleep 1; count allPlayers > 0}; // Ожидание игроков
    [] execVM "TVD\core\main.sqf"; // Запуск TVD на сервере
};
if (hasInterface) then { 
    [] execVM "TVD\client\actions.sqf"; // Клиентские действия
};
```

### Создание баз
В редакторе Arma 3 создайте два триггера для баз сторон:
- **trgBase_side0 (bluefor)**:
  - Переменная: `trgBase_side0`
  - Размер: 50x50 м
  - Активация: `ANYPLAYER`, `PRESENT`
- **trgBase_side1 (opfor)**:
  - Переменная: `trgBase_side1`
  - Размер: 50x50 м
  - Активация: `ANYPLAYER`, `PRESENT`
Эти триггеры определяют зоны для отступления и отправки юнитов в резерв.

### Размещение юнитов
- Добавьте играбельных юнитов для `blueforSide` и `opforSide` рядом с их базами (`trgBase_side0` и `trgBase_side1`).
- Первый игрок каждой стороны автоматически становится КС (50 очков), лидеры групп — КО (25 очков).

## Использование
- **Конфигурация**:
  - ```Настройте параметры в `TVD\config.sqf` (зоны, отступление, время)```
  - ```Создайте триггеры баз (`trgBase_side0`, `trgBase_side1`) и маркеры зон (`mZone_X`)```

- **Интерфейс администратора**:
  - ```Нажмите `Ctrl + ]` для завершения миссии или уничтожения AI```

- **Уведомления игроков**:
  - ```Сообщения отправляются всем или конкретной стороне через систему уведомлений```

- **Расширения**:
  - ```Добавьте ящики с маркировкой или обыск через ACE3```

## Совместимость
- ```Интеграция с `a3a` для завершения миссий с реплеем```
- ```Совместимость с ACE3 для механик плена и обыска (опционально)```

## Разработка
- Разработано для SolidGames.
- Лицензия: MIT.