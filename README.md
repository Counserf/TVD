# TVD - Tactical Victory Determination

TVD (Tactical Victory Determination) — это скриптовый мод для Arma 3, разработанный для SolidGames, добавляющий механику подсчёта очков, управления задачами, отступления и завершения миссии на основе действий игроков и заданных условий. Подходит для PvP и кооперативных сценариев с двумя сторонами, определяемыми через `mission_parameters.hpp` (`blueforSide` и `opforSide`).

## Основные возможности
- **Динамическое завершение миссии**:
  - '''Истечение времени (код 1) с плавным дебрифингом'''
  - '''Тяжёлые потери (код 2) с возможностью продления командиром'''
  - '''Отступление стороны (код 3) с передачей техники врагу'''
  - '''Выполнение ключевой задачи (код 4) с немедленным завершением'''

- **Интерфейс администратора**:
  - '''Вызывается через Ctrl + ] для администраторов (serverCommandAvailable "#kick")'''
  - '''"Техническое завершение" — плавное завершение с уведомлением, затемнением и дебрифингом через a3a_fnc_endMission'''
  - '''"Завершение без реплея" — быстрое завершение с уведомлением через endMission без дебрифинга'''
  - '''"Убить всех ботов" — уничтожение всех AI-юнитов без уведомления игроков'''

- **Логирование и дебрифинг**:
  - '''Все события (убийства, задачи, отступления) записываются в TVD_MissionLog'''
  - '''Дебрифинг через TVD_writeDebrief отображается при завершении с реплеем'''
  - '''Логирование админских действий в серверный лог через diag_log'''

- **Уведомления игроков**:
  - '''Функции TVD_notifyPlayers и TVD_notifySide для отправки сообщений (заголовки, динамический текст, уведомления о задачах)'''

## Требования
- **Arma 3** (версия 2.0+ рекомендуется).
- **CBA_A3** (Community Base Addons) — для асинхронных функций и обработчиков событий.
- **ACE3** (опционально) — для механик плена и обыска.

## Установка

### Подготовка структуры миссии
1. Создайте папку миссии в `Documents\Arma 3\missions`, например, `TVD_Mission.Stratis`.
2. Скопируйте папку `TVD` из репозитория в корень миссии. Итоговая структура:
   '''text
   TVD_Mission.Stratis/
   ├── description.ext
   ├── init.sqf
   ├── mission_parameters.hpp
   ├── stringtable.xml
   └── TVD/
       ├── config.sqf
       ├── core/
       │   ├── init.sqf
       │   ├── main.sqf
       │   ├── score.sqf
       │   ├── tasks.sqf
       │   └── end.sqf
       ├── client/
       │   ├── actions.sqf
       │   ├── admin_menu.sqf
       │   └── ui.sqf
       ├── utils/
       │   ├── helpers.sqf
       │   └── logging.sqf
       ├── ext/
       │   ├── init.sqf
       │   ├── frisk.sqf
       │   └── mark_box.sqf
       └── actions/
           ├── retreat.sqf
           ├── reserve.sqf
           ├── capture.sqf
           ├── hq_transfer.sqf
           └── heavy_losses.sqf
   '''

### Настройка `description.ext`
Убедитесь, что в `description.ext` подключены параметры миссии:
'''cpp
class A3A_MissionParams {
    #include "mission_parameters.hpp"
};
'''

### Настройка `mission_parameters.hpp`
Укажите стороны конфликта:
'''cpp
// Противоборствующие стороны ("WEST", "EAST", "INDEPENDENT")
blueforSide = "WEST";
opforSide = "EAST";
'''
- Допустимые значения: `"WEST"`, `"EAST"`, `"INDEPENDENT"`.
- Союзники `INDEPENDENT` определяются в редакторе через настройки фракций.

### Настройка `init.sqf`
Добавьте в `init.sqf` в корне миссии следующий код для запуска TVD:
'''sqf
if (isServer) then {  
    waitUntil {sleep 1; count allPlayers > 0}; // Ожидание игроков
    [] execVM "TVD\core\main.sqf"; // Запуск TVD
};
if (hasInterface) then { 
    [] execVM "TVD\client\actions.sqf"; // Клиентские действия
};
'''

### Создание баз
В редакторе Arma 3 создайте два триггера для баз сторон:
- **trgBase_side0 (bluefor)**:
  - Переменная: `trgBase_side0`
  - Размер: 50x50 м
  - Активация: `ANYPLAYER`, `PRESENT`
- **trgBase_side1 (opfor)**:
  - Переменная: `trgBase_side1`
  - Размер: 50x50 м
  - Активация: `ANYPLAYER`, `PRESENT`

Эти триггеры определяют зоны для отступления и отправки юнитов в резерв.

### Размещение юнитов
- Добавьте играбельных юнитов для `blueforSide` и `opforSide` рядом с их базами (`trgBase_side0` и `trgBase_side1`).
- Назначьте командиров (КС) с помощью переменной:
  '''sqf
  this setVariable ["TVD_UnitValue", [west, 50, "sideLeader"], true]; // КС для blueforSide
  '''

## Использование
- **Конфигурация**:
  - '''Настройте TVD_Sides, TVD_CapZonesCount, TVD_ZoneGain и другие параметры в TVD\config.sqf'''
  - '''Создайте триггеры trgBase_side0 и trgBase_side1 в редакторе для баз сторон'''
  - '''Добавьте маркеры mZone_X для зон захвата, если TVD_CapZonesCount > 0'''

- **Интерфейс администратора**:
  - '''Нажмите Ctrl + ] во время миссии (требуются права администратора)'''
  - '''Выберите действие из диалога: завершение с дебрифингом (через a3a_fnc_endMission), без дебрифинга (через endMission) или уничтожение AI'''

- **Уведомления игроков**:
  - '''Используйте TVD_notifyPlayers для отправки сообщений всем или выбранным игрокам (типы: "title", "dynamic", "task")'''
  - '''Используйте TVD_notifySide для уведомлений конкретной стороне'''

## Совместимость
- '''TVD интегрирован с a3a для завершения миссий с реплеем через a3a_fnc_endMission'''
- '''Отсутствие перехвата a3a_endMissionTime — завершение админом только через интерфейс TVD'''
- '''Совместимость с ACE3 для механик плена и обыска (опционально)'''

## Разработка
- Разработано для SolidGames.
- Лицензия: MIT.