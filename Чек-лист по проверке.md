# Чек-лист тестирования функций TVD

## TVD/core/score.sqf

### TVD_updateScore
- **Описание**: Обновляет текущие очки сторон (пехота, ценные юниты, зоны, резервы).
- **Шаги тестирования**:
  1. Создать миссию с двумя сторонами (west, east) и игроками (по 5 на сторону).
  2. Вызвать `[] call TVD_updateScore` через консоль.
  3. Проверить, что `TVD_SidesInfScore` равно `[50, 50]` (10 очков за каждого из 5 игроков).
  4. Добавить технику (например, танк) с переменной `TVD_UnitValue = [west, 100]` и убить половину пехоты west.
  5. Повторно вызвать функцию и проверить, что `TVD_SidesValScore` включает 100 для west, а `TVD_SidesInfScore` уменьшилось для west.
  6. Создать зону `mZone_0` с цветом `ColorBLUFOR` и установить `TVD_CapZonesCount = 1`.
  7. Вызвать функцию и убедиться, что `TVD_SidesZonesScore` добавляет `TVD_ZoneGain` (50) для west.
  8. Отправить юнит в резерв через `TVD_sendToReserve` и проверить `TVD_SidesResScore`.

### TVD_calculateWin
- **Описание**: Рассчитывает итоги миссии и определяет победителя.
- **Шаги тестирования**:
  1. Настроить миссию с `TVD_InitScore = [1000, 1000, 0]` (west, east, нейтральные).
  2. Убить 70% игроков east и вызвать `[1] call TVD_calculateWin` (истечение времени).
  3. Проверить, что возвращается массив `[west, степень, процент_west, процент_east, потери]`, где степень > 0.
  4. Установить `TVD_SideRetreat = east` и вызвать `[3, 1] call TVD_calculateWin`.
  5. Убедиться, что east получает корректировку потерь (меньше из-за отступления).
  6. Провести тест с равными потерями и проверить, что степень = 0 (ничья).

## TVD/core/tasks.sqf

### TVD_updateTasks
- **Описание**: Обновляет состояние задач, проверяет их выполнение.
- **Шаги тестирования**:
  1. Создать триггер с `TVD_TaskObject = [west, 100, "Захватить зону", true, ["false", "false", "false", "false", "true"], true]`.
  2. Вызвать `[] call TVD_updateTasks` и убедиться, что триггер добавлен в `TVD_TaskObjectsList`.
  3. Активировать триггер (войти в зону игроком west) и повторно вызвать функцию.
  4. Проверить, что `TVD_TaskObjectsList` уменьшился, а `TVD_MissionComplete = west`.
  5. Установить `timeToEnd = 1` и вызвать `[true] call TVD_updateTasks`, убедиться, что незавершённые задачи провалены.

### TVD_completeTask
- **Описание**: Завершает задачу, обновляет очки и логирует.
- **Шаги тестирования**:
  1. Создать триггер с `TVD_TaskObject = [west, 100, "Test Task", true, [], false]`.
  2. Вызвать `[триггер, west, 0, "Test Task", true, false] call TVD_completeTask`.
  3. Проверить, что `TVD_TaskObjectsList select 0` увеличился на 1, а `TVD_InitScore select 1` (east) увеличился на 100.
  4. Убедиться, что уведомление "Test Task" отображается игрокам west и east.
  5. Проверить лог через `TVD_MissionLog`.

## TVD/core/end.sqf

### TVD_endMission
- **Описание**: Завершает миссию с дебрифингом.
- **Шаги тестирования**:
  1. Настроить миссию с игроками west и east, вызвать `[1, false] call TVD_endMission` (время вышло).
  2. Проверить, что отображается дебрифинг с текстом "Time's up" и результатами.
  3. Установить `TVD_HeavyLosses = west` и вызвать `[2, false, west] call TVD_endMission`.
  4. Убедиться, что причина в дебрифинге — "Side has too few forces left".
  5. Провести тест с `[0, true]` и проверить быстрое завершение (25 секунд).

### TVD_quickEnd
- **Описание**: Быстрое завершение с дебрифингом на 25 секунд.
- **Шаги тестирования**:
  1. Вызвать `["Test Title", "Test Text"] spawn TVD_quickEnd` через консоль.
  2. Убедиться, что текст отображается в виде hintC ровно 25 секунд.
  3. Закрыть hint вручную и проверить очистку экрана.

### TVD_smoothEnd
- **Описание**: Плавное завершение с затемнением и дебрифингом.
- **Шаги тестирования**:
  1. Вызвать `["Mission End", "Test Text", true] spawn TVD_smoothEnd`.
  2. Проверить затемнение экрана (5 секунд), затем отображение дебрифинга (25 секунд).
  3. Убедиться, что урон игроку отключён во время дебрифинга.

### TVD_monitorEnd
- **Описание**: Мониторит условия завершения с возможностью продления.
- **Шаги тестирования**:
  1. Назначить игрока командиром (`TVD_UnitValue = [west, 50, "sideLeader"]`).
  2. Вызвать `[2, west] spawn TVD_monitorEnd`.
  3. Проверить уведомление с таймером и текстом "Side has too few forces left".
  4. Убедиться, что командир видит действие "Extend mission" при `em_ttw < 60`.
  5. Выполнить действие и проверить увеличение времени на 5 минут.

## TVD/client/actions.sqf

### TVD_addClientActions
- **Описание**: Добавляет действия игроку (отступление, резерв, командование).
- **Шаги тестирования**:
  1. Создать миссию с базой `trgBase_side0` (west) и игроком west.
  2. Запустить миссию и проверить наличие действия "Retreat to your rear".
  3. Войти в зону базы, выбрать действие, подтвердить и убедиться в вызове `TVD_retreatSoldier`.
  4. Добавить пленного (ACE3 handcuffed) и проверить действие "Send captive to rear".
  5. Добавить технику рядом с базой и проверить действие "Send vehicle to rear".
  6. Назначить игрока командиром и проверить действие "Side: Order retreat".

## TVD/client/ui.sqf

### TVD_notifyPlayers
- **Описание**: Отправляет уведомление игрокам с заданным типом.
- **Шаги тестирования**:
  1. Вызвать `[0, "Test Message", "title"] call TVD_notifyPlayers`.
  2. Проверить отображение текста внизу экрана у всех игроков.
  3. Вызвать `[west, "Dynamic Test", "dynamic"] call TVD_notifyPlayers` и убедиться в плавном появлении текста.
  4. Вызвать `[[west, "Task Test"], "task"] call TVD_notifyPlayers` и проверить уведомление "TaskSucceeded" для west.

### TVD_notifySide
- **Описание**: Отправляет уведомление стороне.
- **Шаги тестирования**:
  1. Вызвать `[west, "Side Test", "title"] call TVD_notifySide`.
  2. Проверить, что только игроки west видят сообщение.
  3. Вызвать `[sideLogic, "All Test"] call TVD_notifySide` и убедиться, что все игроки получают уведомление.

## TVD/actions/capture.sqf

### TVD_captureVehicle
- **Описание**: Обрабатывает захват техники.
- **Шаги тестирования**:
  1. Создать танк с `TVD_UnitValue = [west, 100]` и `TVD_CapOwner = west`.
  2. Игроку east войти в танк и вызвать `[танк, игрок] call TVD_captureVehicle`.
  3. Проверить, что `TVD_CapOwner` изменён на east.
  4. Убедиться, что событие логируется через `TVD_logEvent`.

## TVD/actions/heavy_losses.sqf

### TVD_monitorHeavyLosses
- **Описание**: Мониторит тяжёлые потери сторон.
- **Шаги тестирования**:
  1. Создать миссию с 10 игроками west и 10 east.
  2. Запустить `[] spawn TVD_monitorHeavyLosses`.
  3. Убить 7 игроков west и проверить, что `TVD_SideCanRetreat select 0` становится `true` при `TVD_RetreatRatio = 0.3`.
  4. Убить ещё 2 и убедиться, что `TVD_HeavyLosses = west` при `TVD_hl_ratio = 0.2`.

## TVD/actions/hq_transfer.sqf

### TVD_hqTransfer
- **Описание**: Передаёт командование при смерти командира.
- **Шаги тестирования**:
  1. Создать группу west с командиром (`TVD_UnitValue = [west, 50, "sideLeader"]`) и КО (`TVD_UnitValue = [west, 30, "squadLeader"]`).
  2. Убить командира и вызвать `["slTransfer", командир] call TVD_hqTransfer`.
  3. Проверить, что КО получил роль "execSideLeader" и уведомление.
  4. Убить всех КО и убедиться, что сторона получает сообщение "Некому принять командование".

## TVD/actions/reserve.sqf

### TVD_sendToReserve
- **Описание**: Отправляет юнит или технику в резерв.
- **Шаги тестирования**:
  1. Создать пленного east на базе west и вызвать `[пленный, игрок_west] call TVD_sendToReserve`.
  2. Проверить уведомление и удаление юнита через 2 секунды.
  3. Добавить танк (`TVD_UnitValue = [west, 100]`) и вызвать `[танк, игрок_west] call TVD_sendToReserve`.
  4. Дождаться 2.5 минуты и проверить дым, затем 3 минуты — удаление танка и очки в `TVD_SidesResScore`.

## TVD/actions/retreat.sqf

### TVD_retreatSide
- **Описание**: Выполняет отступление всей стороны.
- **Шаги тестирования**:
  1. Создать миссию с базой west и техникой вне зоны.
  2. Вызвать `[west] call TVD_retreatSide`.
  3. Проверить уничтожение юнитов вне базы и передачу техники east.
  4. Убедиться, что зоны перекрашены в цвет east.

### TVD_retreatSoldier
- **Описание**: Выполняет отступление одного солдата.
- **Шаги тестирования**:
  1. Создать игрока west и вызвать `[игрок] call TVD_retreatSoldier`.
  2. Проверить уведомление и удаление юнита через 2 секунды.
  3. Убедиться, что `TVD_SidesResScore` увеличился на `TVD_SoldierCost`.

## TVD/utils/helpers.sqf

### TVD_colorToSide
- **Описание**: Преобразует цвет маркера в сторону.
- **Шаги тестирования**:
  1. Вызвать `["ColorBLUFOR"] call TVD_colorToSide` и проверить, что возвращается `west`.
  2. Вызвать `["ColorOPFOR"] call TVD_colorToSide` и проверить `east`.
  3. Вызвать `["InvalidColor"] call TVD_colorToSide` и проверить `sideLogic`.

### TVD_sideToColor
- **Описание**: Преобразует сторону в цвет маркера.
- **Шаги тестирования**:
  1. Вызвать `[west] call TVD_sideToColor` и проверить "ColorBLUFOR".
  2. Вызвать `[east] call TVD_sideToColor` и проверить "ColorOPFOR".
  3. Вызвать `[sideUnknown] call TVD_sideToColor` и проверить "ColorBlack".

### TVD_sideToIndex
- **Описание**: Преобразует сторону в индекс.
- **Шаги тестирования**:
  1. Вызвать `[west] call TVD_sideToIndex` и проверить 1.
  2. Вызвать `[east] call TVD_sideToIndex` и проверить 0.
  3. Вызвать `[sideUnknown] call TVD_sideToIndex` и проверить -1.

### TVD_unitRole
- **Описание**: Преобразует роль юнита в текст.
- **Шаги тестирования**:
  1. Вызвать `["sideLeader"] call TVD_unitRole` и проверить "КС".
  2. Вызвать `["squadLeader"] call TVD_unitRole` и проверить "КО".
  3. Вызвать `["unknown"] call TVD_unitRole` и проверить "".

### TVD_addSideScore
- **Описание**: Добавляет очки стороне.
- **Шаги тестирования**:
  1. Вызвать `[west, 50, true, "Test Score", true] call TVD_addSideScore`.
  2. Проверить, что `TVD_InitScore select 1` (east) увеличился на 50.
  3. Убедиться, что событие логируется и отображается уведомление.

## TVD/utils/logging.sqf

### TVD_logEvent
- **Описание**: Логирует событие с временной меткой.
- **Шаги тестирования**:
  1. Вызвать `["killed", юнит_west] call TVD_logEvent` с юнитом `TVD_UnitValue = [west, 50, "squadLeader"]`.
  2. Проверить, что `TVD_MissionLog` содержит запись с именем юнита и ролью "КО".
  3. Вызвать `["scheduled", []] call TVD_logEvent` и проверить отчёт о состоянии миссии.

### TVD_logMission
- **Описание**: Логирует итоги миссии.
- **Шаги тестирования**:
  1. Завершить миссию и вызвать `[[west, 2, 70, 30, [30, 70]], 1] call TVD_logMission`.
  2. Проверить запись в `diag_log` с итогами и переменными миссии.
  3. Убедиться, что лог отправлен куратору, если он есть.

### TVD_logCurator
- **Описание**: Логирует отчёт для куратора.
- **Шаги тестирования**:
  1. Вызвать `["Test Log"] call TVD_logCurator` на клиенте администратора.
  2. Проверить вывод в `diag_log` с префиксом "TVD_ExportLog:".

### TVD_writeDebrief
- **Описание**: Формирует текст дебрифинга.
- **Шаги тестирования**:
  1. Вызвать `[1, [west, 2, 70, 30, [30, 70]]] call TVD_writeDebrief`.
  2. Проверить, что текст содержит "Time's up", соотношение сил и лог событий.
  3. Убедиться, что зоны отображаются корректно в правой колонке.

## TVD/ext/frisk.sqf

### TVD_frisk (включает TVD_addFriskAction)
- **Описание**: Инициализирует механику обыска.
- **Шаги тестирования**:
  1. Создать игрока east, сделать его пленным через ACE3.
  2. Запустить миссию и дождаться появления действия "Обыскать".
  3. Выполнить действие игроком west и проверить открытие инвентаря.
  4. Убедиться, что действие исчезает, если юнит освобождён.

## TVD/ext/mark_box.sqf

### TVD_markBox
- **Описание**: Создаёт маркеры для ящиков.
- **Шаги тестирования**:
  1. Создать ящик с `TVD_markBox = [west, "Test Box"]`.
  2. Запустить миссию игроком west и проверить маркер "Test Box" оранжевого цвета.
  3. Дождаться 5 минут и убедиться, что маркер исчез.
